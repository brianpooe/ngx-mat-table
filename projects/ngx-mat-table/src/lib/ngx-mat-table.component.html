<mat-form-field style="padding-left: 2em;">
  <input
    matInput
    placeholder="Search"
    (keyup)="filterSubject.next($event.target.value)"
  />
</mat-form-field>

<div class="mat-elevation-z8">
  <mat-table
    [dataSource]="dataSource"
    matSort
    matSortDisableClear="true"
    [matSortActive]="defaultSort.active"
    [matSortDirection]="defaultSort.direction"
    multiTemplateDataRows
  >
    <ng-container
      *ngFor="let col of tableCols$ | async as tableCols; let i = index"
      [matColumnDef]="col.key"
    >
      <mat-header-cell *matHeaderCellDef mat-sort-header>{{
        tableCols[i]["display"]
      }}</mat-header-cell>
      <mat-cell *matCellDef="let element">
        <!-- Checking if it's a normal column or column with specific config -->
        <ng-container *ngIf="!col.config; else hasConfig">
          {{ element[col.key] }}
        </ng-container>
        <!-- If this column has a config object so we will display depending
  on our setted config -->
        <ng-template #hasConfig>
          <!-- if this attribute is a date, we will format it depending on format
      value in config object -->
          <ng-container *ngIf="col.config.isDate">
            {{ element[col.key] | date: col.config.format }}
          </ng-container>
          <!-- if this column is action, we will loop through each action and show
      it as a mat-button -->
          <ng-container *ngIf="col.config.isAction">
            <button
              mat-icon-button
              color="warn"
              style="margin: 5px; cursor: pointer;"
              *ngFor="let action of col.config.actions"
              (click)="emitAction(action)"
              attr.aria-label="{{ action }}"
            >
              <mat-icon title="{{ action }}"> {{ action }}_outline</mat-icon>
            </button>
          </ng-container>
        </ng-template>
      </mat-cell>
    </ng-container>

    <ng-container matColumnDef="noData">
      <mat-footer-cell
        class="no-data-cell"
        *matFooterCellDef
        [attr.colspan]="keys.length"
      >
        <span>No Data</span>
      </mat-footer-cell>
    </ng-container>

    <ng-container matColumnDef="errorData">
      <mat-footer-cell
        class="no-data-cell"
        *matFooterCellDef
        [attr.colspan]="keys.length"
      >
        <span>System Failure</span>
        <span>Error</span>
        <span class="retry" (click)="retry()">Retry</span>
      </mat-footer-cell>
    </ng-container>

    <ng-container matColumnDef="loadingData">
      <mat-footer-cell
        class="no-data-cell"
        *matFooterCellDef
        [attr.colspan]="keys.length"
      >
        <span>Retrieving data...</span>
      </mat-footer-cell>
    </ng-container>

    <mat-header-row *matHeaderRowDef="keys; sticky: true"></mat-header-row>
    <ng-container *ngIf="(total$ | async) && !(loading$ | async)">
      <mat-row *matRowDef="let row; columns: keys"></mat-row>
    </ng-container>

    <ng-container *ngIf="!(total$ | async)">
      <mat-footer-row *matFooterRowDef="['noData']"></mat-footer-row>
    </ng-container>
    <ng-container *ngIf="(error$ | async) && !(total$ | async)">
      <mat-footer-row *matFooterRowDef="['errorData']"></mat-footer-row>
    </ng-container>
    <ng-container *ngIf="loading$ | async">
      <mat-footer-row *matFooterRowDef="['loadingData']"></mat-footer-row>
    </ng-container>
  </mat-table>

  <mat-paginator
    [length]="total$ | async"
    [pageSize]="pageSize$ | async"
    [pageSizeOptions]="pageSizeOptions$ | async"
  ></mat-paginator>
</div>
